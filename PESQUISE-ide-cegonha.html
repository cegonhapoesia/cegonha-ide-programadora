<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cegonha IDE + Bing Voz</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f0f4f8;
      text-align: center;
      transition: background-color 0.3s, color 0.3s;
    }
    header {
      background-color: #4caf50;
      color: white;
      padding: 20px;
      font-size: 24px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .editor {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 20px;
    }
    textarea {
      width: 30%;
      height: 200px;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      resize: vertical;
    }
    button {
      padding: 12px 20px;
      margin: 10px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #388e3c;
    }
    iframe {
      width: 90%;
      height: 300px;
      border: 2px solid #4caf50;
      border-radius: 10px;
      background: white;
    }
    #mensagemVoz {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
    }
    .dark-mode {
      background-color: #2e2e2e;
      color: #fff;
    }
    .dark-mode header {
      background-color: #333;
    }
    .dark-mode textarea {
      background-color: #444;
      color: #fff;
    }
    .dark-mode iframe {
      background-color: #444;
    }
    @media (max-width: 768px) {
      textarea {
        width: 90%;
      }
      header {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    Cegonha IDE üïäÔ∏è
    <div>
      <button onclick="pesquisaPorVoz()">üé§ Falar Pesquisa</button>
      <button id="btnPesquisar" onclick="executarPesquisa()" disabled>üîç Iniciar Pesquisa</button>
      <button onclick="executarComandoVoz()">üéôÔ∏è Comando da IDE</button>
      <button onclick="mudarTema()">üåô / üåû Mudar Tema</button>
    </div>
  </header>

  <div class="editor">
    <textarea id="html" placeholder="HTML aqui..."><h1>Ol√°, Mundo!</h1><a href='https://example.com'>Abrir site</a></textarea>
    <textarea id="css" placeholder="CSS aqui...">h1 { color: purple; text-align: center; }</textarea>
    <textarea id="js" placeholder="JS aqui...">console.log("Executado com sucesso!");</textarea>
  </div>

  <button onclick="executar()">‚ñ∂Ô∏è Executar C√≥digo</button>
  <button onclick="limparEditor()">üßπ Limpar Editor</button>

  <div id="mensagemVoz"></div>
  <iframe id="preview"></iframe>

  <script>
    let termoPesquisa = '';

    function executar() {
      const html = document.getElementById("html").value;
      const css = `<style>${document.getElementById("css").value}</style>`;
      const js = `<script>${document.getElementById("js").value}<\/script>`;
      const safeLinks = `
        <script>
          document.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && e.target.href) {
              e.preventDefault();
              window.open(e.target.href, '_blank');
            }
          });
        <\/script>
      `;
      const code = html + css + js + safeLinks;

      const iframe = document.getElementById("preview");
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(code);
      doc.close();
    }

    function limparEditor() {
      document.getElementById("html").value = "";
      document.getElementById("css").value = "";
      document.getElementById("js").value = "";
      exibirMensagem("üßπ Editor limpo!");
    }

    function falar(texto) {
      const fala = new SpeechSynthesisUtterance(texto);
      fala.lang = "pt-BR";
      speechSynthesis.speak(fala);
    }

    function exibirMensagem(msg) {
      document.getElementById("mensagemVoz").innerText = msg;
    }

    function pesquisaPorVoz() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Este navegador n√£o suporta reconhecimento de voz.");
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "pt-BR";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        console.log("üé§ Ouvindo...");
        exibirMensagem("üé§ Fale agora... Ex: 'pesquisar gatos fofos'");
        falar("Pode falar o que quer pesquisar no Bing.");
      };

      recognition.onresult = (event) => {
        termoPesquisa = event.results[0][0].transcript.toLowerCase().trim();
        console.log("üîç Comando reconhecido:", termoPesquisa);
        exibirMensagem(`üé§ Termo de pesquisa reconhecido: ${termoPesquisa}`);
        falar("Pesquisa pronta. Clique no bot√£o para iniciar.");
        document.getElementById("btnPesquisar").disabled = false; // Habilita o bot√£o de pesquisa
      };

      recognition.onerror = (event) => {
        console.error("Erro ao reconhecer:", event.error);
        exibirMensagem("‚ö†Ô∏è Erro ao reconhecer voz: " + event.error);
        falar("Houve um erro ao reconhecer sua voz.");
      };

      recognition.onend = () => {
        console.log("üé§ Reconhecimento de voz finalizado.");
      };

      recognition.start();
    }

    function executarPesquisa() {
      if (termoPesquisa) {
        exibirMensagem(`üîç Pesquisando por: ${termoPesquisa}`);
        falar("Pesquisando por " + termoPesquisa);
        const url = "https://www.bing.com/search?q=" + encodeURIComponent(termoPesquisa);
        window.open(url, "_blank");
      } else {
        exibirMensagem("üòï Nenhum termo de pesquisa foi detectado.");
        falar("N√£o h√° termo para pesquisar.");
      }
      document.getElementById("btnPesquisar").disabled = true; // Desabilita o bot√£o ap√≥s a pesquisa
    }

    function executarComandoVoz() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Este navegador n√£o suporta reconhecimento de voz.");
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "pt-BR";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        console.log("üé§ Ouvindo...");
        exibirMensagem("üé§ Diga 'executar c√≥digo' ou 'limpar editor'");
        falar("Pode dizer: executar c√≥digo ou limpar editor.");
      };

      recognition.onresult = (event) => {
        const texto = event.results[0][0].transcript.toLowerCase().trim();
        console.log("üîç Comando reconhecido:", texto);

        if (texto.includes("executar c√≥digo")) {
          executar();
          exibirMensagem("‚ñ∂Ô∏è C√≥digo Executado com Sucesso!");
          falar("C√≥digo executado com sucesso!");
        } else if (texto.includes("limpar editor")) {
          limparEditor();
          falar("Editor limpo.");
        } else {
          exibirMensagem("üòï N√£o entendi o comando.");
          falar("N√£o entendi. Tente dizer: executar c√≥digo ou limpar editor.");
        }
      };

      recognition.onerror = (event) => {
        console.error("Erro ao reconhecer:", event.error);
        exibirMensagem("‚ö†Ô∏è Erro ao reconhecer voz: " + event.error);
        falar("Houve um erro ao reconhecer sua voz.");
      };

      recognition.onend = () => {
        console.log("üé§ Reconhecimento de voz finalizado.");
      };

      recognition.start();
    }

    function mudarTema() {
      document.body.classList.toggle("dark-mode");
      const tema = document.body.classList.contains("dark-mode") ? "escuro" : "claro";
      exibirMensagem(`üåô Tema ${tema} ativado.`);
    }

    window.onload = executar;
  </script>
</body>
</html>
